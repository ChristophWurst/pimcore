sudo: false
language: php

notifications:
  email:
    #- travis-ci@pimcore.org

addons:
  apt:
    packages:
      - apache2
      - libapache2-mod-fastcgi

php:
  - 5.5
  - 5.6
  - 7
  - hhvm

cache:
  directories:
    - $HOME/.composer/cache/files

matrix:
  allow_failures:
    - php: hhvm

install:
  - composer install

before_script:
  # customize php settings
  - chmod 0755 build/travis/setup-fpm.sh build/travis/setup-hhvm.sh
  - if [[ "$TRAVIS_PHP_VERSION" != *"hhvm"* ]]; then build/travis/setup-fpm.sh; fi
  - if [[ "$TRAVIS_PHP_VERSION" == *"hhvm"* ]]; then build/travis/setup-hhvm.sh; fi
  # configure apache virtual hosts - config was copied in the individual setup scripts above (FPM/HHVM)
  - cd tests

script:
  - if [[ "$TRAVIS_PHP_VERSION" != *"hhvm"* ]]; then sh ./alltests.sh; fi
  - if [[ "$TRAVIS_PHP_VERSION" == *"hhvm"* ]]; then sh ./hhvm-all.sh; fi

after_script:
  - cat $TRAVIS_BUILD_DIR/tests/tmp/var/log/debug.log
  - cat $TRAVIS_BUILD_DIR/tests/tmp/var/log/php.log
  - cat $TRAVIS_BUILD_DIR/apache-error.log
  - cat $TRAVIS_BUILD_DIR/apache-access.log
  - cat /tmp/hhvm.log

